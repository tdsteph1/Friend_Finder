<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Survey</title>

  <!-- Latest compiled and minified CSS & JS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
  <script src="https://code.jquery.com/jquery.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

  

</head>

<body>

<div class="container">

<h2> Survey Questions </h2>
<hr>

<h3> <b> About You </b> </h3>

<form>
 
 	<!-- Name textbox -->
    <label for="name"> Name (Required) </label>
    <input type="text" class="form-control" id="name">
	
	<br>
	
    <!-- Photo link textbox -->
    <label for="photo"> Link to Photo Image </label>
    <input type="text" class="form-control" id="photo">

    <hr>
	
	<h3> <b> Question 1 </b> </h3>
	<h4> You Like to play videogames. </h4>
	<div class="dropdown">
    	<select class="btn-lg dropButton" id="q1">
    		<option> </option>
  			<option value="1">1 (Strongly Disagree) </option>
  			<option value="2">2</option>
  			<option value="3">3</option>
  			<option value="4">4</option>
  			<option value="5">5 (Strongly Agree)</option>
		</select>
  	</div>

  	<h3> <b> Question 2 </b> </h3>
	<h4> Reading is a must </h4>
	<div class="dropdown">
    	<select class="btn-lg dropButton" id="q2">
    		<option> </option>
  			<option value="1">1 (Strongly Disagree)</option>
  			<option value="2">2</option>
  			<option value="3">3</option>
  			<option value="4">4</option>
  			<option value="5">5 (Strongly Agree)</option>
		</select>
  	</div>

  	<h3> <b> Question 3 </b> </h3>
	<h4> Exercise is important </h4>
	<div class="dropdown">
    	<select class="btn-lg dropButton" id="q3">
    		<option> </option>
  			<option value="1">1 (Strongly Disagree)</option>
  			<option value="2">2</option>
  			<option value="3">3</option>
  			<option value="4">4</option>
  			<option value="5">5 (Strongly Agree)</option>
		</select>
  	</div>

  	<h3> <b> Question 4 </b> </h3>
	<h4> Likes to hangout in large groups </h4>
	<div class="dropdown">
    	<select class="btn-lg dropButton" id="q4">
    		<option> </option>
  			<option value="1">1 (Strongly Disagree)</option>
  			<option value="2">2</option>
  			<option value="3">3</option>
  			<option value="4">4</option>
  			<option value="5">5 (Strongly Agree)</option>
		</select>
  	</div>

  	<h3> <b> Question 5 </b> </h3>
	<h4> Consider yourself tolerant of others </h4>
	<div class="dropdown">
    	<select class="btn-lg dropButton" id="q5">
    		<option> </option>
  			<option value="1">1 (Strongly Disagree)</option>
  			<option value="2">2</option>
  			<option value="3">3</option>
  			<option value="4">4</option>
  			<option value="5">5 (Strongly Agree)</option>
		</select>
  	</div>

  	<h3> <b> Question 6 </b> </h3>
	<h4> Loves the great outdoors </h4>
	<div class="dropdown">
    	<select class="btn-lg dropButton" id="q6">
    		<option> </option>
  			<option value="1">1 (Strongly Disagree)</option>
  			<option value="2">2</option>
  			<option value="3">3</option>
  			<option value="4">4</option>
  			<option value="5">5 (Strongly Agree)</option>
		</select>
  	</div>

  	<h3> <b> Question 7 </b> </h3>
	<h4> Likes going to the beach </h4>
	<div class="dropdown">
    	<select class="btn-lg dropButton" id="q7">
    		<option> </option>
  			<option value="1">1 (Strongly Disagree)</option>
  			<option value="2">2</option>
  			<option value="3">3</option>
  			<option value="4">4</option>
  			<option value="5">5 (Strongly Agree)</option>
		</select>
  	</div>

  	<h3> <b> Question 8 </b> </h3>
	<h4> Level of computer skills </h4>
	<div class="dropdown">
    	<select class="btn-lg dropButton" id="q8">
    		<option> </option>
  			<option value="1">1 (Strongly Disagree)</option>
  			<option value="2">2</option>
  			<option value="3">3</option>
  			<option value="4">4</option>
  			<option value="5">5 (Strongly Agree)</option>
		</select>
  	</div>

  	<h3> <b> Question 9 </b> </h3>
	<h4> Loves to draw </h4>
	<div class="dropdown">
    	<select class="btn-lg dropButton" id="q9">
    		<option> </option>
  			<option value="1">1 (Strongly Disagree)</option>
  			<option value="2">2</option>
  			<option value="3">3</option>
  			<option value="4">4</option>
  			<option value="5">5 (Strongly Agree)</option>
		</select>
  	</div>

  	<h3> <b> Question 10 </b> </h3>
	<h4> Enjoys watching sports </h4>
	<div class="dropdown">
    	<select class="btn-lg dropButton" id="q10">
    		<option> </option>
  			<option value="1">1 (Strongly Disagree)</option>
  			<option value="2">2</option>
  			<option value="3">3</option>
  			<option value="4">4</option>
  			<option value="5">5 (Strongly Agree)</option>
		</select>
  	</div>




   

</form>

<br>
<br>


<button type="submit" class="btn btn-primary btn-lg" id="add-btn"><span class="glyphicon glyphicon-fire"></span> Submit </button>



<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Best Match</h4>
      </div>
      <div class="modal-body">

      	<!-- Insert The name of the object inside friendsArray -->
        <span id="theName"> </span>

        <!-- Insert Photo of the object -->
        <span id="img"> </span>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<br>
<br>
<br>
<br>

</div>
</body>
</html>

<!-- JAVASCRIPT -->
<script type="text/javascript">

	//global object variable that gets pushed into friendsArrray
	var newFriend;
	
	//Create an array to hold "#q1" ... "#q10" values
	var qArray = [];

	//When user preses the submit button check to see if any of the fields are blank
	//prior to pushing (q1-q10) results onto the object array/friendsArray
    $("#add-btn").click(function(event)
    {
        event.preventDefault();

        //Ensures that users have entered data in textfilesds &&
        //entered data inside all 10 dropdown questions.
        var textfieldCondition = validateTextfield();
        var dropDownMenuCondition = validateDropDownMenu();

       
        //If either textfiels or dropdown questions are blank alert error and do not submit
        //until user has successfully filled out 2 textfiels && 10 dropdown questions.
        if(textfieldCondition !== false && dropDownMenuCondition != false )
        {
        	runPost();
        }
        else
        {
        	alert("please fill out all fields befor submitting")
        }

        

        //qArray = []; //resets the array

	
    });


//Function2
function validateTextfield()
{
	if($("#name").val().trim() === "" || $("#photo").val().trim() === "")
	{
		return false;
	}

	return true;

}

//Function2
function validateDropDownMenu()
{
	
	//push all 10 Questions onto qArray
        for(var i = 1; i <= 10; i++)
        {
        	//check for blank prior to pushing onto array because we don't want to push more than 10 
        	//because if we get the error message we have to hit submit again hence push again which is 
        	//something we do NOT want!
        	if($("#q" + i).val() === "")
        	{
        		//get out of the function to prevent push.
        		//We only push until user has entered all 10 drop down questions
        		return false
        	}
        	
        }

        //Now we can push onto array now that we've checked all questions have been submitted.
        for(var i = 1; i <= 10; i++)
        {
        	//qArray.push($("#q" + i).val()); //Obtains actual value inside drop down

        	//Selects <option value=#> avoiding selecting 1 (strongly disagree)
        	//this obtains value at a particular <select id=q1...q10> or particular question
        	var id = document.getElementById("q" + i);
			var theValue = id.options[id.selectedIndex].value;

			//push choice of particular question onto qArray
			qArray.push(theValue);
			

        	
        }
        console.log("qArray " + qArray);

        return true
}

//Function3: Executes the POST function after validating 2 textboxes & 10 dropdown questions.
function runPost()
{
	
	//create info Object
	newFriend =
	{
		name: $("#name").val().trim(),
		photo: $("#photo").val().trim(),
		scores: qArray

	};
	
	//display all properties to make sure everything works
	console.log(newFriend.name);
	console.log(newFriend.photo);
	console.log(newFriend.scores);

	//This is very similar to the standard ajax function we used.
	//Essentially we give it a URL, we give it the object we want to send, then
	//we have a "callback"
	//The callback is the response of the server. Inour case, we set up code in api-routes
	//that returns true or false depending if table is availible or not.
	$.post("/api/friends", newFriend, function(data)
	{
		if(data)
		{
			console.log(newFriend.scores);
			//alert("Friend Added!!!");

			//launches the modal at this point in the code when user has
			//succesfully entered a new friend inside the friendsArray
			// at localhost:3000/api/friends
			//$("#myModal").modal('show');

			runFriendQuery();

		}


		//Clear all data
		$("#name").val("");
		$("#photo").val("");
		$(".dropButton").val("");

		//Clear Array
		qArray = [];
		
	
	});

   
}


//Function4
function runFriendQuery()
{
	

	//Here we get the location of the root page.
	//We use this instead of explicitly saying the URL is localhost:3000 becasue
	//the url will change when we deploy.
	var currentURL = window.location.origin;

	//The AJAX function uses the URL of our API to GET the data associated with it
	//(initially set to localhost)
	$.ajax(
	{
		url: currentURL + "/api/friends",	//this allows us to access friendsArray
		method: "GET"

	}).done(function(friendData)
	{
		var arrayOfTotalDifference = [];
		var totalDifference = 0;

		//Set this initially to the first object inside friendsArray
		//change this variable when we've reached a new smaller value
		

		
		for(var i = 0; i < friendData.length - 1; i++)	//-1 to exclude the newly added user or (newFriend) we only focus on previous existing user.
		{
			for(var j = 0; j < friendData[i].scores.length; j++)
			{
				
				//New user (10 Quesitons Results) - (Current existing user Question Results)
				//EX [1, 2, 3...] 
				//	  -  -  -   (minus)
				//   [3, 2, 1...] = 2, 0, 2
				var difference = Math.abs(parseInt(newFriend.scores[j]) - parseInt(friendData[i].scores[j]));
				console.log("dif " + difference);

				//Store a running sum for total difference. so each time we loop through of the 10 results
				//we're adding each diffence for 10 loops(10 elements stored inside scores[] array)
				totalDifference = totalDifference + difference;

			}
			

			//push totalDifferce onto totalDifferenceArray to compare each user's(friendsArray) result
			//and 
			arrayOfTotalDifference.push(totalDifference);

			//resets variables
			totalDifference = 0;
		}

		//Use Math to obtain the smalles value in the ArrayOfTotalDifference array
		//and also obtain the index of the smallest value in order to find out
		//the index of the object that is inside of the array(friednsArray)
		var small = Math.min.apply(null, arrayOfTotalDifference);		
		
		var indexOfSmallestObject = arrayOfTotalDifference.indexOf(small); 

		//Now that we know the location(index) of the friendArray that contians 
		//the object that is compatible with newFriend, we can now post
		//the object's name && photo inside the modal.

		//Displays the objects name inside the body of the modal by locating the modal's name id
		$("#theName").html("<h4> " + friendData[indexOfSmallestObject].name + "<h4>");

		$("#img").html("<img src='" + friendData[indexOfSmallestObject].photo + "' width='200' height='200'>");

		//Display modal
		$("#myModal").modal('show');




	});

}


</script>
